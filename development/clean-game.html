<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxia - Clean Version</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            font-family: Arial, sans-serif;
            color: white;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            z-index: 2;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            display: flex;
            gap: 10px;
        }

        .character-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: linear-gradient(to bottom, #4a4a4a, #2a2a2a);
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .character-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
        }

        #mastiffButton { background: linear-gradient(to bottom, #8B4513, #654321); }
        #tigerButton { background: linear-gradient(to bottom, #FF4500, #B22222); }
        #shipButton { background: linear-gradient(to bottom, #4169E1, #000080); }

        #wallet-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 15px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
            border: 1px solid rgba(65, 105, 225, 0.3);
            backdrop-filter: blur(5px);
        }
        
        #audio-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 15px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border: 2px solid rgba(74, 74, 247, 0.6);
            box-shadow: 0 0 20px rgba(74, 74, 247, 0.3);
            backdrop-filter: blur(5px);
            pointer-events: all;
        }
        
        #music-info {
            font-size: 14px;
            color: #4169E1;
            text-align: center;
            margin: 5px 0;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        #change-music {
            background: linear-gradient(to bottom, #4a4af7, #2a2a8a);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        #change-music:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(74, 74, 247, 0.5);
        }
        
        .volume-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        #volume-slider {
            width: 100px;
            cursor: pointer;
        }
        
        #mute-button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            margin: 0;
        }

        #connect-wallet {
            background: #4169E1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        #connect-wallet:hover {
            background: #1E90FF;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        #wallet-status {
            font-size: 14px;
            color: #4169E1;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        #coin-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            color: gold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.4);
            padding: 8px 15px;
            border-radius: 20px;
        }

        #instructions {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            z-index: 2;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
        }

        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            text-align: center;
            z-index: 3;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="controls">
            <button id="mastiffButton" class="character-btn">Tibetan Mastiff</button>
            <button id="tigerButton" class="character-btn">Sumatran Tiger</button>
            <button id="shipButton" class="character-btn">Galaxy Ship</button>
        </div>
        <div id="wallet-container">
            <div id="coin-display">
                <span>ðŸª™</span>
                <span id="coin-count">0</span>
            </div>
            <button id="connect-wallet">Connect Wallet</button>
            <div id="wallet-status">Not connected</div>
        </div>
        
        <!-- Audio controls will be created dynamically by JavaScript -->
        <div id="instructions">
            Click to Attack | Double Click for Special Attack | Drag to Rotate View
        </div>
        <div id="loading">Loading 3D Models...</div>
    </div>

    <script>
        // Clean implementation of the game
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Clean game initializing...');
            
            // Initialize variables
            let currentCharacter = "tibetanMastiff";
            let score = 0;
            let playerCoins = parseInt(localStorage.getItem('playerCoins')) || 0;
            let isGameOver = false;
            const loadingElement = document.getElementById('loading');
            
            // Update coin display
            document.getElementById('coin-count').textContent = playerCoins;
            
            // Web3 connection
                        // Add background changing functionality
            const changeBackgroundBtn = document.createElement('button');
            changeBackgroundBtn.id = 'change-background';
            changeBackgroundBtn.textContent = 'Change Background';
            changeBackgroundBtn.style.cssText = `
                background: linear-gradient(to bottom, #8e44ad, #6c3483);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
                margin-bottom: 10px;
                transition: all 0.3s ease;
            `;
            changeBackgroundBtn.addEventListener('mouseover', () => {
                changeBackgroundBtn.style.transform = 'scale(1.05)';
                changeBackgroundBtn.style.boxShadow = '0 4px 8px rgba(0,0,0,0.3)';
            });
            changeBackgroundBtn.addEventListener('mouseout', () => {
                changeBackgroundBtn.style.transform = 'scale(1)';
                changeBackgroundBtn.style.boxShadow = 'none';
            });
            changeBackgroundBtn.addEventListener('click', () => {
                loadRandomBackground();
            });
            document.getElementById('wallet-container').prepend(changeBackgroundBtn);
            
            // Create audio controls dynamically
            function createAudioControls() {
                console.log('Creating audio controls');
                const audioControls = document.createElement('div');
                audioControls.id = 'audio-controls';
                audioControls.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    z-index: 9999;
                    background: rgba(0, 0, 0, 0.9);
                    padding: 15px;
                    border-radius: 15px;
                    color: white;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                    border: 2px solid rgba(74, 74, 247, 0.6);
                    box-shadow: 0 0 20px rgba(74, 74, 247, 0.3);
                    backdrop-filter: blur(5px);
                    pointer-events: all;
                    width: 220px;
                `;
                
                // Music info display
                const musicInfo = document.createElement('div');
                musicInfo.id = 'music-info';
                musicInfo.textContent = 'Loading music...';
                musicInfo.style.cssText = `
                    font-size: 14px;
                    color: #4169E1;
                    text-align: center;
                    margin: 5px 0;
                    max-width: 200px;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                `;
                audioControls.appendChild(musicInfo);
                
                // Change music button
                const changeMusic = document.createElement('button');
                changeMusic.id = 'change-music';
                changeMusic.textContent = 'Change Music';
                changeMusic.style.cssText = `
                    background: linear-gradient(to bottom, #4a4af7, #2a2a8a);
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                    transition: all 0.3s ease;
                    width: 100%;
                `;
                changeMusic.addEventListener('mouseover', () => {
                    changeMusic.style.transform = 'scale(1.05)';
                    changeMusic.style.boxShadow = '0 0 15px rgba(74, 74, 247, 0.5)';
                });
                changeMusic.addEventListener('mouseout', () => {
                    changeMusic.style.transform = 'scale(1)';
                    changeMusic.style.boxShadow = 'none';
                });
                changeMusic.addEventListener('click', () => {
                    playRandomTrack();
                });
                audioControls.appendChild(changeMusic);
                
                // Volume controls container
                const volumeControls = document.createElement('div');
                volumeControls.className = 'volume-controls';
                volumeControls.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    margin-top: 5px;
                    width: 100%;
                `;
                
                // Mute button
                const muteButton = document.createElement('button');
                muteButton.id = 'mute-button';
                muteButton.textContent = 'ðŸ”Š';
                muteButton.style.cssText = `
                    background: none;
                    border: none;
                    color: white;
                    font-size: 20px;
                    cursor: pointer;
                    padding: 0;
                    margin: 0;
                `;
                muteButton.addEventListener('click', () => {
                    if (isMuted) {
                        // Unmute
                        audioPlayer.volume = document.getElementById('volume-slider').value;
                        muteButton.textContent = 'ðŸ”Š';
                        isMuted = false;
                    } else {
                        // Mute
                        audioPlayer.volume = 0;
                        muteButton.textContent = 'ðŸ”‡';
                        isMuted = true;
                    }
                });
                volumeControls.appendChild(muteButton);
                
                // Volume slider
                const volumeSlider = document.createElement('input');
                volumeSlider.id = 'volume-slider';
                volumeSlider.type = 'range';
                volumeSlider.min = '0';
                volumeSlider.max = '1';
                volumeSlider.step = '0.1';
                volumeSlider.value = '0.5';
                volumeSlider.style.cssText = `
                    width: 100px;
                    cursor: pointer;
                `;
                volumeSlider.addEventListener('input', (e) => {
                    audioPlayer.volume = e.target.value;
                    // Update mute button based on volume
                    if (parseFloat(e.target.value) === 0) {
                        muteButton.textContent = 'ðŸ”‡';
                        isMuted = true;
                    } else {
                        muteButton.textContent = 'ðŸ”Š';
                        isMuted = false;
                    }
                });
                volumeControls.appendChild(volumeSlider);
                
                audioControls.appendChild(volumeControls);
                
                // Add to document
                document.body.appendChild(audioControls);
                console.log('Audio controls created and added to document');
                
                return audioControls;
            }
            
            document.getElementById('connect-wallet').addEventListener('click', () => {
                if (typeof window.ethereum !== 'undefined') {
                    window.ethereum.request({ method: 'eth_requestAccounts' })
                        .then(accounts => {
                            const userAccount = accounts[0];
                            document.getElementById('wallet-status').textContent = 
                                `Connected: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                            document.getElementById('wallet-status').style.color = '#4CAF50';
                            document.getElementById('connect-wallet').style.display = 'none';
                        })
                        .catch(error => {
                            console.error('User denied account access', error);
                        });
                } else {
                    alert('Please install MetaMask to use crypto features!');
                    window.open('https://metamask.io/download.html', '_blank');
                }
            });
            
            // Three.js setup
            const canvas = document.getElementById('gameCanvas');
            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000);
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(0, 1, 1);
            scene.add(directionalLight);
            
            // Set up background system with TV fantasy art
            const backgroundTexture = new THREE.TextureLoader();
            let currentBackground = null;
            const backgroundSphere = new THREE.Mesh(
                new THREE.SphereGeometry(500, 60, 40),
                new THREE.MeshBasicMaterial({ color: 0x000000 })
            );
            // Flip the geometry inside out
            backgroundSphere.scale.x = -1;
            scene.add(backgroundSphere);
            
            // Set up background music system
            let audioPlayer = new Audio();
            audioPlayer.volume = 0.5;
            audioPlayer.loop = false;
            let currentTrack = '';
            let isMuted = false;
            
            // List of music tracks
            const musicTracks = [
                'front-end/assets/sounds/music/Cosmic Pulse.mp3',
                'front-end/assets/sounds/music/Galaxia Combat 01.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial 2.1.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial 2.2.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial-Inspired 1.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial-Inspired 3.1.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial-Inspired 3.2.mp3',
                'front-end/assets/sounds/music/Industrial Orbit.mp3',
                'front-end/assets/sounds/music/Nebula Core 1.mp3',
                'front-end/assets/sounds/music/Nebula Core 2.mp3',
                'front-end/assets/sounds/music/Quantum Circuitry 1.mp3',
                'front-end/assets/sounds/music/Quantum Circuitry 2.mp3',
                'front-end/assets/sounds/music/Stellar Drift 1.mp3',
                'front-end/assets/sounds/music/Stellar Drift 2.mp3'
            ];
            
            // List of background images
            const backgroundImages = [
                'front-end/assets/Images/backgrounds/Akira Toriyama Inspired Manga.jpg',
                'front-end/assets/Images/backgrounds/Alan Lee Inpspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Alan Lee Inspired Alien World.jpg',
                'front-end/assets/Images/backgrounds/Alicia Austin  Inspired Nebula.jpg',
                'front-end/assets/Images/backgrounds/Amano Inspired Alien World.jpg',
                'front-end/assets/Images/backgrounds/Boris Vallejo Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Christopher Norton Moore  Inspired Nebula.jpg',
                'front-end/assets/Images/backgrounds/David Burroughs Mattingly  Inspired Nebula.jpg',
                'front-end/assets/Images/backgrounds/Donato Giancola  Inspired Nebula.jpg',
                'front-end/assets/Images/backgrounds/Donato Giancola Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Frank Frazetta Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Frank Kelly Freas Inspired Alien World.jpg',
                'front-end/assets/Images/backgrounds/Gerald Brom Inspired Alien World.jpg',
                'front-end/assets/Images/backgrounds/Gervasio Gallardo Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Gustavo Cabral Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Hiromu Arakawa Inspired Manga.jpg',
                'front-end/assets/Images/backgrounds/Jean-Baptiste Monge Inspired Nebula.jpg',
                'front-end/assets/Images/backgrounds/Jeff Easley Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Jim Burns Inspired Alien World.jpg',
                'front-end/assets/Images/backgrounds/Jim Warren Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Keith A. Parkinson Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Larry Elmore Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Leiji Matsumoto Inspired Manga.jpg',
                'front-end/assets/Images/backgrounds/Michael Whelan Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Naoki Urasawa Inspired Manga.jpg',
                'front-end/assets/Images/backgrounds/Naoko Takeuchi Inspired Manga.jpg',
                'front-end/assets/Images/backgrounds/Ted Nasmith Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Tim White Inspired Fantasy Piece 2.jpg',
                'front-end/assets/Images/backgrounds/Wayne Douglas Barlowe Inspired Piece 2.jpg',
                'front-end/assets/Images/backgrounds/William Stout Inspired Piece 2.jpg'
            ];
            
            // Function to load a random background
            function loadRandomBackground() {
                const randomIndex = Math.floor(Math.random() * backgroundImages.length);
                loadBackground(backgroundImages[randomIndex]);
            }
            
            // Function to load a specific background
            function loadBackground(imagePath) {
                console.log(`Loading background: ${imagePath}`);
                backgroundTexture.load(
                    imagePath,
                    (texture) => {
                        backgroundSphere.material.dispose();
                        backgroundSphere.material = new THREE.MeshBasicMaterial({
                            map: texture,
                            side: THREE.BackSide  // Ensure the texture is visible from inside
                        });
                        currentBackground = imagePath;
                        console.log(`Background loaded: ${imagePath}`);
                    },
                    (progress) => {
                        console.log(`Loading background: ${(progress.loaded / progress.total * 100).toFixed(0)}%`);
                    },
                    (error) => {
                        console.error(`Error loading background: ${imagePath}`, error);
                        // Try with a different path format
                        const alternatePath = imagePath.replace('front-end/', '');
                        console.log(`Trying alternate path: ${alternatePath}`);
                        backgroundTexture.load(
                            alternatePath,
                            (texture) => {
                                backgroundSphere.material.dispose();
                                backgroundSphere.material = new THREE.MeshBasicMaterial({
                                    map: texture,
                                    side: THREE.BackSide
                                });
                                currentBackground = alternatePath;
                                console.log(`Background loaded: ${alternatePath}`);
                            },
                            null,
                            (secondError) => {
                                console.error(`Error loading background with alternate path: ${alternatePath}`, secondError);
                            }
                        );
                    }
                );
            }
            
            // Load initial random background
            loadRandomBackground();
            
            // Character models
            const models = {};
            const loader = new THREE.GLTFLoader();
            
            function loadModel(name, path) {
                // Try different path formats
                const tryPaths = [
                    path,
                    `./assets/models/${path}`,
                    `../assets/models/${path}`,
                    `/assets/models/${path}`,
                    `https://charlo21.github.io/Galaxia/assets/models/${path}`
                ];
                
                console.log(`Attempting to load model: ${name}`);
                loadingElement.textContent = `Loading ${name}...`;
                
                // Try each path
                function tryNextPath(index) {
                    if (index >= tryPaths.length) {
                        console.error(`Failed to load model: ${name} after trying all paths`);
                        loadingElement.textContent = `Error loading ${name}. Please refresh.`;
                        return;
                    }
                    
                    const currentPath = tryPaths[index];
                    console.log(`Trying path: ${currentPath}`);
                    
                    loader.load(
                        currentPath,
                        (gltf) => {
                            models[name] = gltf.scene;
                            console.log(`Successfully loaded model: ${name}`);
                            scene.add(gltf.scene);
                            
                            // Initially hide all models
                            gltf.scene.visible = false;
                            
                            // If all models are loaded, hide loading and show initial character
                            if (Object.keys(models).length === 3) {
                                loadingElement.style.display = 'none';
                                showCharacter(currentCharacter);
                            }
                        },
                        (progress) => {
                            console.log(`Loading ${name}: ${(progress.loaded / progress.total * 100).toFixed(0)}%`);
                        },
                        (error) => {
                            console.warn(`Error loading ${currentPath}:`, error);
                            tryNextPath(index + 1);
                        }
                    );
                }
                
                tryNextPath(0);
            }
            
            // Load all models
            loadModel('tibetanMastiff', 'tibetan_mastiff.glb');
            loadModel('sumatranTiger', 'sumatran_tiger.glb');
            loadModel('galaxyShip', 'spaceship.glb');
            
            // Function to show a specific character
            function showCharacter(character) {
                // Hide all models first
                for (const name in models) {
                    if (models[name]) {
                        models[name].visible = false;
                    }
                }
                
                // Show the selected character
                if (models[character]) {
                    models[character].visible = true;
                    currentCharacter = character;
                    console.log(`Showing character: ${character}`);
                } else {
                    console.warn(`Character model not loaded: ${character}`);
                }
            }
            
            // Button event listeners
            document.getElementById('mastiffButton').addEventListener('click', () => {
                showCharacter('tibetanMastiff');
            });
            
            document.getElementById('tigerButton').addEventListener('click', () => {
                showCharacter('sumatranTiger');
            });
            
            document.getElementById('shipButton').addEventListener('click', () => {
                showCharacter('galaxyShip');
            });
            
            // Function to simulate attack
            canvas.addEventListener('click', () => {
                if (models[currentCharacter]) {
                    // Rotate the model slightly to show attack
                    models[currentCharacter].rotation.y += 0.5;
                    score += 10;
                    console.log(`Attack! Score: ${score}`);
                }
            });
            
            // Function to simulate special attack
            canvas.addEventListener('dblclick', () => {
                if (models[currentCharacter]) {
                    // Rotate the model more to show special attack
                    models[currentCharacter].rotation.y += 1.5;
                    score += 30;
                    console.log(`Special Attack! Score: ${score}`);
                }
            });
            
            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // Create audio controls
            const audioControlsElement = createAudioControls();
            
            // Function to play a random music track
            function playRandomTrack() {
                const randomIndex = Math.floor(Math.random() * musicTracks.length);
                playTrack(musicTracks[randomIndex]);
            }
            
            // Function to play a specific track
            function playTrack(trackPath) {
                console.log(`Loading music track: ${trackPath}`);
                const musicInfo = document.getElementById('music-info');
                musicInfo.textContent = 'Loading track...'; 
                
                // Save current volume
                const currentVolume = audioPlayer.volume;
                
                // Stop current track
                audioPlayer.pause();
                
                // Try to load with the provided path
                try {
                    audioPlayer = new Audio(trackPath);
                    audioPlayer.volume = currentVolume;
                    audioPlayer.addEventListener('canplaythrough', () => {
                        audioPlayer.play();
                        currentTrack = trackPath;
                        // Display track name (remove path and extension)
                        const trackName = trackPath.split('/').pop().replace('.mp3', '');
                        musicInfo.textContent = trackName;
                        console.log(`Now playing: ${trackName}`);
                    });
                    
                    // Handle errors
                    audioPlayer.addEventListener('error', () => {
                        console.error(`Error loading track: ${trackPath}`);
                        // Try with alternate path
                        const alternatePath = trackPath.replace('front-end/', '');
                        console.log(`Trying alternate path: ${alternatePath}`);
                        tryAlternatePath(alternatePath, currentVolume);
                    });
                    
                    // When track ends, play next random track
                    audioPlayer.addEventListener('ended', () => {
                        console.log('Track ended, playing next random track');
                        playRandomTrack();
                    });
                } catch (error) {
                    console.error('Error creating audio player:', error);
                    musicInfo.textContent = 'Error playing music';
                }
            }
            
            // Function to try loading with an alternate path
            function tryAlternatePath(alternatePath, volume) {
                try {
                    audioPlayer = new Audio(alternatePath);
                    audioPlayer.volume = volume;
                    audioPlayer.addEventListener('canplaythrough', () => {
                        audioPlayer.play();
                        currentTrack = alternatePath;
                        // Display track name (remove path and extension)
                        const trackName = alternatePath.split('/').pop().replace('.mp3', '');
                        document.getElementById('music-info').textContent = trackName;
                        console.log(`Now playing: ${trackName}`);
                    });
                    
                    // When track ends, play next random track
                    audioPlayer.addEventListener('ended', () => {
                        playRandomTrack();
                    });
                    
                    // If alternate path also fails, show error
                    audioPlayer.addEventListener('error', () => {
                        console.error(`Error loading track with alternate path: ${alternatePath}`);
                        document.getElementById('music-info').textContent = 'Error playing music';
                        // Try another random track
                        setTimeout(playRandomTrack, 2000);
                    });
                } catch (error) {
                    console.error('Error creating audio player with alternate path:', error);
                    document.getElementById('music-info').textContent = 'Error playing music';
                    // Try another random track
                    setTimeout(playRandomTrack, 2000);
                }
            }
            
            // Volume and mute controls are now set up in the createAudioControls function
            
            // Start playing random music track
            playRandomTrack();
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                // Rotate models slightly for animation
                for (const name in models) {
                    if (models[name] && models[name].visible) {
                        models[name].rotation.y += 0.01;
                    }
                }
                
                // Slow rotation of the background sphere for effect
                if (backgroundSphere) {
                    backgroundSphere.rotation.y += 0.0001;
                }
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Daily reward check
            setTimeout(() => {
                const lastLogin = localStorage.getItem('lastLogin');
                const currentDate = new Date().getTime();
                const timeLimit = 24 * 60 * 60 * 1000; // 24 hours
                
                if (!lastLogin || (currentDate - parseInt(lastLogin)) > timeLimit) {
                    // Give reward
                    const reward = { coins: 100, rarity: 'common' };
                    
                    // Create reward message
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(0, 0, 0, 0.9);
                        padding: 20px;
                        border-radius: 10px;
                        color: white;
                        text-align: center;
                        z-index: 1000;
                        border: 2px solid #4169E1;
                    `;
                    
                    modal.innerHTML = `
                        <h2 style="color: #4169E1;">Daily Reward!</h2>
                        <p>${reward.rarity.toUpperCase()} Daily Reward: ${reward.coins} coins!</p>
                        <button onclick="this.parentElement.remove()" style="
                            background: #4169E1;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">Claim</button>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Update coins
                    playerCoins += reward.coins;
                    localStorage.setItem('playerCoins', playerCoins.toString());
                    document.getElementById('coin-count').textContent = playerCoins;
                    
                    // Update last login
                    localStorage.setItem('lastLogin', currentDate.toString());
                }
            }, 2000);
        });
    </script>
    <!-- Direct music player script added inline to ensure it loads -->
    <script>
        // Immediately-invoked function to handle music playback
        (function() {
            console.log('Inline music player initializing at timestamp:', new Date().getTime());
            
            // List of music tracks with absolute paths to ensure they're found
            const musicTracks = [
                'front-end/assets/sounds/music/Cosmic Pulse.mp3',
                'front-end/assets/sounds/music/Galaxia Combat 01.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial 2.1.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial 2.2.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial-Inspired 1.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial-Inspired 3.1.mp3',
                'front-end/assets/sounds/music/High-Energy Techno & Industrial-Inspired 3.2.mp3',
                'front-end/assets/sounds/music/Industrial Orbit.mp3',
                'front-end/assets/sounds/music/Nebula Core 1.mp3',
                'front-end/assets/sounds/music/Nebula Core 2.mp3',
                'front-end/assets/sounds/music/Quantum Circuitry 1.mp3',
                'front-end/assets/sounds/music/Quantum Circuitry 2.mp3',
                'front-end/assets/sounds/music/Stellar Drift 1.mp3',
                'front-end/assets/sounds/music/Stellar Drift 2.mp3',
                'assets/sounds/music/Cosmic Pulse.mp3',
                'assets/sounds/music/Galaxia Combat 01.mp3',
                'assets/sounds/music/High-Energy Techno & Industrial 2.1.mp3',
                'assets/sounds/music/High-Energy Techno & Industrial 2.2.mp3',
                'assets/sounds/music/High-Energy Techno & Industrial-Inspired 1.mp3',
                'assets/sounds/music/High-Energy Techno & Industrial-Inspired 3.1.mp3',
                'assets/sounds/music/High-Energy Techno & Industrial-Inspired 3.2.mp3',
                'assets/sounds/music/Industrial Orbit.mp3',
                'assets/sounds/music/Nebula Core 1.mp3',
                'assets/sounds/music/Nebula Core 2.mp3',
                'assets/sounds/music/Quantum Circuitry 1.mp3',
                'assets/sounds/music/Quantum Circuitry 2.mp3',
                'assets/sounds/music/Stellar Drift 1.mp3',
                'assets/sounds/music/Stellar Drift 2.mp3'
            ];
            
            // Get the last played track index from localStorage
            const lastPlayedIndex = parseInt(localStorage.getItem('galaxiaLastTrack') || '-1');
            console.log('Last played track index was:', lastPlayedIndex);
            
            // Create audio element
            let audioPlayer = new Audio();
            audioPlayer.volume = 0.5;
            audioPlayer.id = 'background-music';
            document.body.appendChild(audioPlayer); // Add to DOM to ensure it's loaded
            
            // Function to play a random track
            function playRandomTrack() {
                // Get a random index, different from last played
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * musicTracks.length);
                } while (randomIndex === lastPlayedIndex && musicTracks.length > 1);
                
                // Save this index for next page load
                localStorage.setItem('galaxiaLastTrack', randomIndex.toString());
                
                const trackPath = musicTracks[randomIndex];
                console.log('Attempting to play track:', trackPath);
                
                // Try to play the track
                try {
                    audioPlayer.src = trackPath;
                    
                    audioPlayer.oncanplaythrough = function() {
                        audioPlayer.play()
                            .then(() => {
                                console.log('Successfully playing:', trackPath);
                            })
                            .catch(error => {
                                console.error('Error during play():', error);
                            });
                    };
                    
                    audioPlayer.onerror = function(e) {
                        console.error('Error loading audio:', e);
                        // If we're at an even index, try the alternative path (we have pairs of paths)
                        if (randomIndex % 2 === 0 && randomIndex + 1 < musicTracks.length) {
                            console.log('Trying alternative path');
                            audioPlayer.src = musicTracks[randomIndex + 1];
                        } else {
                            // Try another random track
                            setTimeout(playRandomTrack, 1000);
                        }
                    };
                    
                    // When track ends, play another random one
                    audioPlayer.onended = playRandomTrack;
                    
                } catch (error) {
                    console.error('Error setting up audio player:', error);
                }
            }
            
            // Start playback when page loads
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                // Document already loaded
                setTimeout(playRandomTrack, 1000);
            } else {
                // Wait for document to load
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(playRandomTrack, 1000);
                });
            }
        })();
    </script>
</body>
</html>
